# 현재 시스템 분석

## 📊 시스템 개요

### 아키텍처

```
┌─────────────┐
│   Client    │
│   (React)   │
└──────┬──────┘
       │ HTTP
┌──────┴──────┐
│ Spring Boot │
│   FastAPI   │
└──────┬──────┘
       │
┌──────┴──────┐
│   MariaDB   │
└─────────────┘
```

## 🔧 기술 스택

### 클라이언트
- **프레임워크**: React (Create React App)
- **차트 라이브러리**: TradingView Lightweight Charts v5
- **주요 기능**:
  - 백엔드 데이터로 차트, 종목 이름, 거래량 시각화
  - 가로선 저장
  - 배당락 버튼 및 세로선
  - 배당일 구간마다 최저/최고가 표시
  - 사이드바 토글
  - 차트 요소 토글 (배당, 최저/최고, 거래량)

### 서버
- **기술 스택**: 
  - Spring Boot
  - FastAPI
  - MariaDB
- **주요 기능**:
  - 매일 15:40 한국투자증권 서버에서 데이터 가져오기
  - 클라이언트 요청 데이터 제공
- **데이터 수집**: REST API 방식

## 💾 데이터베이스 구조

### 테이블 및 크기

| Table      | Size (MB) | 설명 |
|------------|-----------|------|
| stock      | 0.27      | 주식 시고저종거 데이터 |
| dividend   | 0.06      | 배당금, 배당락일 |
| stock_info | 0.05      | 종목 정보 (이름, 주기) |
| data_time  | 0.03      | 마지막 데이터 갱신 시간 |
| horizontal | 0.02      | 가로선 사용자 데이터 |
| **총합**   | **0.43**  | |

### 테이블 상세

#### 1. stock
주식의 일별 시고저종거 데이터

| 컬럼   | 타입   | 설명 |
|--------|--------|------|
| code   | string | 종목코드 |
| date   | date   | 날짜 |
| open   | float  | 시가 |
| high   | float  | 고가 |
| low    | float  | 저가 |
| close  | float  | 종가 |
| volume | int    | 거래량 |

#### 2. dividend
배당 정보

| 컬럼  | 타입   | 설명 |
|-------|--------|------|
| code  | string | 종목코드 |
| date  | date   | 배당락일 |
| price | float  | 배당금 |

#### 3. stock_info
종목 기본 정보

| 컬럼   | 타입   | 설명 |
|--------|--------|------|
| code   | string | 종목코드 |
| name   | string | 종목명 |
| period | string | 월중/월말 |

#### 4. data_time
데이터 갱신 시간 추적

| 컬럼      | 타입      | 설명 |
|-----------|-----------|------|
| code      | string    | 종목코드 |
| time      | timestamp | 마지막 갱신 시간 |
| data_time | timestamp | 데이터 기준 시간 |

#### 5. horizontal
사용자별 가로선 데이터

| 컬럼       | 타입      | 설명 |
|------------|-----------|------|
| id         | int       | 고유 ID |
| stockcode  | string    | 종목코드 |
| price      | float     | 가격 |
| color      | string    | 선 색상 |
| line_style | string    | 선 스타일 |
| line_width | int       | 선 두께 |
| memo       | string    | 메모 |
| created_at | timestamp | 생성 시간 |
| updated_at | timestamp | 수정 시간 |

## ⚙️ 주요 기능

### 1. 데이터 수집
- **스케줄**: 매일 15:40
- **방식**: FastAPI schedule
- **소스**: 한국투자증권 REST API
- **처리**: 
  1. API 키로 인증
  2. 종목별 데이터 요청
  3. MariaDB에 저장

### 2. 데이터 제공
- **방식**: REST API
- **클라이언트 요청에 따라 데이터 조회 및 반환**

### 3. 차트 시각화
- TradingView Lightweight Charts v5 사용
- 실시간 데이터 업데이트
- 사용자 인터랙션 (줌, 패닝 등)

## ⚠️ 현재 시스템의 문제점

### 1. 서버 의존성
- **문제**: 물리적 서버나 VM이 계속 실행되어야 함
- **영향**: 전기료, 서버 관리 부담

### 2. 스케줄링 의존성
- **문제**: 디바이스가 15:40에 켜져 있어야 데이터 수집
- **영향**: 외출, 정전 시 데이터 누락 가능

### 3. 모바일 최적화 부족
- **문제**: 반응형 디자인 미흡
- **영향**: 모바일에서 사용 불편

### 4. 배포 복잡성
- **문제**: 서버 + DB + 웹 각각 관리
- **영향**: 업데이트 시 수동 작업 필요

### 5. 확장성 제한
- **문제**: 단일 서버 구조
- **영향**: 사용자 증가 시 성능 문제 (현재는 2명이라 무관)

## 📈 데이터 증가 추정

### 일일 증가량
```
종목당 일일 데이터: ~200 bytes
50 종목 × 250 영업일/년 = 2.5 MB/년
10년 = 25 MB
```

### 예상 총 데이터
```
현재: 0.43 MB
5년 후: ~13 MB
10년 후: ~25 MB
```

## 🔐 보안 및 인증

### API 키 관리
- **방식**: 입력 방식 (구체적 방법 확인 필요)
- **개선 필요**: 환경 변수로 관리

### 데이터 접근
- **현재**: 서버 레벨 보안
- **사용자**: 2명 (개인 사용)

## 🎯 유지해야 할 요소

### 필수 유지
1. ✅ **TradingView Lightweight Charts v5**: 우수한 성능과 UX
2. ✅ **React 프론트엔드**: 기존 코드 재사용
3. ✅ **기능**: 차트, 가로선, 배당 표시 등 모든 기능
4. ✅ **15:40 스케줄**: 장 마감 후 데이터 수집 타이밍

### 개선 대상
1. ❌ **서버 인프라**: Firebase로 대체
2. ❌ **MariaDB**: Firestore로 대체
3. ❌ **수동 스케줄링**: Cloud Scheduler로 자동화
4. ❌ **단일 플랫폼**: 반응형 + 모바일 추가

## 📝 확인 필요 사항

### FastAPI 관련
- [ ] Python 버전
- [ ] 사용 중인 한투 API 라이브러리
- [ ] `requirements.txt` 내용
- [ ] 한투 API 호출 코드 위치
- [ ] API 키 저장 위치 및 방식

### React 관련
- [ ] 컴포넌트 구조
- [ ] 상태 관리 방식 (Context API? Redux?)
- [ ] API 호출 로직 위치
- [ ] 환경 변수 사용 여부

### 데이터 관련
- [ ] 전체 종목 수
- [ ] 데이터 히스토리 기간
- [ ] 백업 정책

---

**다음 단계**: [새로운 아키텍처 설계](ARCHITECTURE.md)
